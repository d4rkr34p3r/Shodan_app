#!/usr/bin/env python3

import shodan
from struct import *
from collections import *

API_KEY = 'PON AQUI LA API KEY'
api = shodan.Shodan(API_KEY)

def check_exploits(cve_busqueda):
	try:
		resultados = api.exploits.search(cve_busqueda)
		for elemento in resultados['matches']:
			description = elemento['description']
			for cve in elemento['cve']:
				return description

	except shodan.APIError as e:
		pass

i = 0

try:
	results = api.search('vsat')

#	print('Resultados encontrados: {}'.format(results['total']))

	for result in results['matches']:
		print('IP: %s' %result['ip_str'])
		i+=1
		if(1==1):
		#if(result['location']['country_code'] == "DE"):
			hostdata = api.host(result['ip_str'])
			if("vulns" in hostdata and len(hostdata["vulns"])):
				for vuln in hostdata["vulns"]:
					if vuln.startswith("!"):
						continue

					cve_description = check_exploits(vuln)
					print('-> {}'.format(vuln))
					print('CVE description: {}'.format(cve_description))
					print('- - - - - - - - - - - - - - - - - - - - - - - - -- - - - - - - - -')
				print('')

		print('Dispositivo: %i' %i)

	print("\n Total dispositivos en Shodan: %i" %results['total'])

except shodan.APIError as e:
	print("Error: %s" %e)
